<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sávváltós Akadálykerülő Játék - Felhasználónévvel és Pontszámmal Jobbra</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #222;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #game-wrapper {
            display: flex;
            align-items: center;
        }

        #game-container {
            position: relative;
            width: 400px;
            height: 600px;
            background-color: #333;
            overflow: hidden;
            margin-right: 20px;
        }

        #game-road {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #444;
        }

        .lane {
            position: absolute;
            width: 33.33%;
            height: 100%;
            box-sizing: border-box;
        }

        .lane:nth-child(1) {
            left: 0;
            border-right: 2px dashed white;
        }

        .lane:nth-child(2) {
            left: 33.33%;
            border-right: 2px dashed white;
        }

        .lane:nth-child(3) {
            left: 66.66%;
        }

        #player {
            position: absolute;
            width: 50px;
            height: 80px;
            background-color: #5d9cec;
            border-radius: 5px;
            bottom: 20px;
            left: 175px;
            transition: left 0.2s ease;
            z-index: 100;
        }

        .obstacle {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: #e74c3c;
            border-radius: 5px;
            top: -60px;
        }

        .bonus {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: #2ecc71;
            border-radius: 50%;
            top: -40px;
            z-index: 50;
        }

        #info-container {
            color: white;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 20px;
        }

        #user-name-display {
            font-size: 20px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        #score {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        #high-score {
            font-size: 16px;
            margin-bottom: 10px;
        }

        #difficulty-display {
            font-size: 18px;
        }

        #game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
            color: white;
        }

        #game-over h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        #final-score {
            font-size: 28px;
            margin-bottom: 10px;
        }

        #final-high-score {
            font-size: 18px;
            margin-bottom: 30px;
        }

        button {
            padding: 10px 20px;
            font-size: 18px;
            background-color: #5d9cec;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #4a89dc;
        }

        #user-name-input-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 500;
            color: white;
        }

        #user-name-input-container h2 {
            font-size: 32px;
            margin-bottom: 20px;
        }

        #user-name-input {
            padding: 10px;
            font-size: 18px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 20px;
            width: 250px;
        }

        #submit-user-name-btn {
            padding: 10px 20px;
            font-size: 18px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #submit-user-name-btn:hover {
            background-color: #27ae60;
        }

        #difficulty-selector {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 400;
            color: white;
        }

        #difficulty-selector h2 {
            font-size: 32px;
            margin-bottom: 30px;
        }

        #difficulty-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .road-line {
            position: absolute;
            width: 10px;
            height: 60px;
            background-color: white;
            left: 50%;
            transform: translateX(-50%);
            animation: moveDown 1s linear infinite;
        }

        @keyframes moveDown {
            0% {
                transform: translateX(-50%) translateY(-100px);
            }
            100% {
                transform: translateX(-50%) translateY(700px);
            }
        }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <div id="game-container">
            <div id="game-road">
                <div class="lane"></div>
                <div class="lane"></div>
                <div class="lane"></div>
            </div>
            <div id="player"></div>
        </div>
        <div id="info-container">
            <div id="user-name-display"></div>
            <div id="score">Pontszám: 0</div>
            <div id="high-score">Legjobb: 0</div>
            <div id="difficulty-display">Nehézség: Közepes</div>
        </div>
        <div id="game-over">
            <h2>Játék Vége!</h2>
            <div id="final-score">Végső pontszám: 0</div>
            <div id="final-high-score">Legjobb pontszám: 0</div>
            <div style="display: flex; gap: 10px;">
                <button id="restart-btn">Újrakezdés</button>
                <button id="change-difficulty-btn">Nehézség Változtatása</button>
            </div>
        </div>
        <div id="difficulty-selector">
            <h2>Válassz nehézségi szintet</h2>
            <div id="difficulty-buttons">
                <button id="easy-btn">Könnyű</button>
                <button id="medium-btn">Közepes</button>
                <button id="hard-btn">Nehéz</button>
                <button id="insane-btn">Őrült</button>
            </div>
        </div>
        <div id="user-name-input-container">
            <h2>Add meg a felhasználóneved</h2>
            <input type="text" id="user-name-input">
            <button id="submit-user-name-btn">Mentés</button>
        </div>
    </div>

    <script>
        // Játék változók
        let score = 0;
        let highScore = localStorage.getItem('highscore') || 0;
        let userName = localStorage.getItem('userName') || '';
        let speed = 3;
        let isGameOver = false;
        let lanePositions = [65, 200, 335]; // A három sáv középpontjai
        let currentLane = 1; // Kezdetben a középső sávban vagyunk (0, 1, 2)
        let animationId;
        let obstacles = [];
        let bonuses = [];
        let roadLines = [];
        let obstacleInterval;
        let bonusInterval;
        let roadLineInterval;
        let lastObstacleTime = Date.now();
        let minObstacleInterval = 1000; // Minimum idő két akadály között (ms)

        // Nehézségi szintek beállításai
        const difficultySettings = {
            easy: {
                initialSpeed: 2,
                speedIncrease: 0.1,
                obstacleInterval: 2000,
                minObstacleInterval: 1500,
                bonusFrequency: 5000,
                scoreMultiplier: 1
            },
            medium: {
                initialSpeed: 3,
                speedIncrease: 0.2,
                obstacleInterval: 1500,
                minObstacleInterval: 1000,
                bonusFrequency: 8000,
                scoreMultiplier: 2
            },
            hard: {
                initialSpeed: 4,
                speedIncrease: 0.3,
                obstacleInterval: 1200,
                minObstacleInterval: 800,
                bonusFrequency: 12000,
                scoreMultiplier: 3
            },
            insane: {
                initialSpeed: 5,
                speedIncrease: 0.4,
                obstacleInterval: 1000,
                minObstacleInterval: 600,
                bonusFrequency: 15000,
                scoreMultiplier: 5
            }
        };

        let currentDifficulty = 'medium';

        // DOM elemek
        const player = document.getElementById('player');
        const gameContainer = document.getElementById('game-container');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('high-score');
        const difficultyDisplay = document.getElementById('difficulty-display');
        const gameOverElement = document.getElementById('game-over');
        const finalScoreElement = document.getElementById('final-score');
        const finalHighScoreElement = document.getElementById('final-high-score');
        const restartBtn = document.getElementById('restart-btn');
        const changeDifficultyBtn = document.getElementById('change-difficulty-btn');
        const difficultySelector = document.getElementById('difficulty-selector');
        const easyBtn = document.getElementById('easy-btn');
        const mediumBtn = document.getElementById('medium-btn');
        const hardBtn = document.getElementById('hard-btn');
        const insaneBtn = document.getElementById('insane-btn');
        const gameRoad = document.getElementById('game-road');
        const infoContainer = document.getElementById('info-container');
        const userNameDisplay = document.getElementById('user-name-display');
        const userNameInputContainer = document.getElementById('user-name-input-container');
        const userNameInput = document.getElementById('user-name-input');
        const submitUserNameBtn = document.getElementById('submit-user-name-btn');

        // Felhasználónév betöltése és megjelenítése, vagy bekérése
        if (userName) {
            userNameDisplay.textContent = `Játékos: ${userName}`;
            userNameInputContainer.style.display = 'none';
            difficultySelector.style.display = 'flex';
        } else {
            userNameInputContainer.style.display = 'flex';
            difficultySelector.style.display = 'none';
        }

        // Felhasználónév mentése
        submitUserNameBtn.addEventListener('click', function() {
            const enteredName = userNameInput.value.trim();
            if (enteredName) {
                userName = enteredName;
                localStorage.setItem('userName', userName);
                userNameDisplay.textContent = `Játékos: ${userName}`;
                userNameInputContainer.style.display = 'none';
                difficultySelector.style.display = 'flex';
            } else {
                alert('Kérlek, add meg a felhasználóneved!');
            }
        });

        // Kezdeti highscore megjelenítése
        highScoreElement.textContent = `Legjobb: ${highScore}`;

        // Játékos pozícionálása a kezdeti sávba
        player.style.left = lanePositions[currentLane] - player.offsetWidth / 2 + 'px';

        // Nehézségi szint gombokra eseményfigyelők
        easyBtn.addEventListener('click', function() {
            setDifficulty('easy');
            difficultySelector.style.display = 'none';
            startGame();
        });

        mediumBtn.addEventListener('click', function() {
            setDifficulty('medium');
            difficultySelector.style.display = 'none';
            startGame();
        });

        hardBtn.addEventListener('click', function() {
            setDifficulty('hard');
            difficultySelector.style.display = 'none';
            startGame();
        });

        insaneBtn.addEventListener('click', function() {
            setDifficulty('insane');
            difficultySelector.style.display = 'none';
            startGame();
        });

        // Nehézségi szint beállítása
        function setDifficulty(difficulty) {
            currentDifficulty = difficulty;
            speed = difficultySettings[difficulty].initialSpeed;
            minObstacleInterval = difficultySettings[difficulty].minObstacleInterval;

            // Nehézségi szint megjelenítése
            const difficultyNames = {
                easy: 'Könnyű',
                medium: 'Közepes',
                hard: 'Nehéz',
                insane: 'Őrült'
            };

            difficultyDisplay.textContent = `Nehézség: ${difficultyNames[difficulty]}`;
        }

        // Billentyűzet eseményfigyelő
        document.addEventListener('keydown', function(event) {
            if (isGameOver || difficultySelector.style.display !== 'none' || userNameInputContainer.style.display !== 'none') return;

            if (event.key === 'ArrowLeft' || event.key === 'a') {
                moveLeft();
            } else if (event.key === 'ArrowRight' || event.key === 'd') {
                moveRight();
            }
        });

        // Sávváltás balra
        function moveLeft() {
            if (currentLane > 0) {
                currentLane--;
                player.style.left = lanePositions[currentLane] - player.offsetWidth / 2 + 'px';
            }
        }

        // Sávváltás jobbra
        function moveRight() {
            if (currentLane < 2) {
                currentLane++;
                player.style.left = lanePositions[currentLane] - player.offsetWidth / 2 + 'px';
            }
        }

        // Akadály létrehozása
        function createObstacle() {
            const now = Date.now();
            if (now - lastObstacleTime < minObstacleInterval) return;

            lastObstacleTime = now;

            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';

            // Véletlenszerű sáv kiválasztása
            const lane = Math.floor(Math.random() * 3);
            obstacle.style.left = lanePositions[lane] - 30 + 'px';

            gameContainer.appendChild(obstacle);
            obstacles.push(obstacle);

            // Nehézség növelése a pontszám alapján
            if (score > 0 && score % 10 === 0) {
                speed += difficultySettings[currentDifficulty].speedIncrease;
                if (minObstacleInterval > 400) {
                    minObstacleInterval -= 50;
                }
            }
        }

        // Bónusz létrehozása
        function createBonus() {
            if (isGameOver) return;

            const bonus = document.createElement('div');
            bonus.className = 'bonus';

            // Véletlenszerű sáv kiválasztása, de ne ugyanaz, mint az utolsó akadályé
            let bonusLane;
            if (obstacles.length > 0) {
                const lastObstacle = obstacles[obstacles.length - 1];
                const lastObstacleLeft = parseInt(lastObstacle.style.left);
                const lastObstacleLaneIndex = lanePositions.indexOf(lastObstacleLeft + 30);
                do {
                    bonusLane = Math.floor(Math.random() * 3);
                } while (bonusLane === lastObstacleLaneIndex);
            } else {
                bonusLane = Math.floor(Math.random() * 3);
            }
            bonus.style.left = lanePositions[bonusLane] - 20 + 'px';

            gameContainer.appendChild(bonus);
            bonuses.push(bonus);
        }

        // Út vonalainak létrehozása a mozgás illúziójához
        function createRoadLine() {
            // Középső elválasztó vonal bal oldalon
            const leftLine = document.createElement('div');
            leftLine.className = 'road-line';
            leftLine.style.left = '33.33%';
            gameRoad.appendChild(leftLine);
            roadLines.push(leftLine);

            // Középső elválasztó vonal jobb oldalon
            const rightLine = document.createElement('div');
            rightLine.className = 'road-line';
            rightLine.style.left = '66.66%';
            gameRoad.appendChild(rightLine);
            roadLines.push(rightLine);

            // Az animáció automatikusan gondoskodik a vonalak mozgatásáról
            setTimeout(() => {
                if (leftLine.parentNode === gameRoad) {
                    gameRoad.removeChild(leftLine);
                }
                if (rightLine.parentNode === gameRoad) {
                    gameRoad.removeChild(rightLine);
                }
                roadLines = roadLines.filter(line => line !== leftLine && line !== rightLine);
            }, 1000);
        }

        // Játék frissítése
        function updateGame() {
            if (isGameOver) return;

            // Akadályok mozgatása
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                const obstacleY = obstacle.offsetTop + speed;
                obstacle.style.top = obstacleY + 'px';

                // Ütközés ellenőrzése
                if (isCollision(obstacle, player)) {
                    gameOver();
                    return;
                }

                // Akadály eltávolítása, ha elhagyta a képernyőt
                if (obstacleY > gameContainer.offsetHeight) {
                    gameContainer.removeChild(obstacle);
                    obstacles.splice(i, 1);

                    // Pont növelése, ha sikeresen kikerültük az akadályt
                    score += difficultySettings[currentDifficulty].scoreMultiplier;
                    scoreElement.textContent = `Pontszám: ${score}`;
                }
            }

            // Bónuszok mozgatása
            for (let i = bonuses.length - 1; i >= 0; i--) {
                const bonus = bonuses[i];
                const bonusY = bonus.offsetTop + speed;
                bonus.style.top = bonusY + 'px';

                // Bónusz felvétele
                if (isCollision(bonus, player)) {
                    gameContainer.removeChild(bonus);
                    bonuses.splice(i, 1);

                    // Extra pontok a bónuszért
                    score += 5 * difficultySettings[currentDifficulty].scoreMultiplier;
                    scoreElement.textContent = `Pontszám: ${score}`;

                    // Játékos ideiglenes kiemelése
                    player.style.backgroundColor = '#2ecc71';
                    setTimeout(() => {
                        player.style.backgroundColor = '#5d9cec';
                    }, 300);

                    continue;
                }

                // Bónusz eltávolítása, ha elhagyta a képernyőt
                if (bonusY > gameContainer.offsetHeight) {
                    gameContainer.removeChild(bonus);
                    bonuses.splice(i, 1);
                }
            }

            // Játék folytatása
            animationId = requestAnimationFrame(updateGame);
        }

        // Ütközés ellenőrzése
        function isCollision(element1, element2) {
            const rect1 = element1.getBoundingClientRect();
            const rect2 = element2.getBoundingClientRect();

            return !(
                rect1.bottom < rect2.top ||
                rect1.top > rect2.bottom ||
                rect1.right < rect2.left ||
                rect1.left > rect2.right
            );
        }

        // Játék vége
        function gameOver() {
            isGameOver = true;
            cancelAnimationFrame(animationId);
            clearInterval(obstacleInterval);
            clearInterval(bonusInterval);
            clearInterval(roadLineInterval);

            // Highscore frissítése
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('highscore', highScore);
                highScoreElement.textContent = `Legjobb: ${highScore}`;
            }

            finalScoreElement.textContent = `Végső pontszám: ${score}`;
            finalHighScoreElement.textContent = `Legjobb pontszám: ${highScore}`;
            gameOverElement.style.display = 'flex';
        }

        // Játék újraindítása
        function restartGame() {
            // Előző játék elemeinek tisztítása
            clearGameElements();

            // Változók visszaállítása
            score = 0;
            speed = difficultySettings[currentDifficulty].initialSpeed;
            isGameOver = false;
            currentLane = 1;
            obstacles = [];
            bonuses = [];
            roadLines = [];
            minObstacleInterval = difficultySettings[currentDifficulty].minObstacleInterval;
            lastObstacleTime = Date.now();

            // UI frissítése
            player.style.left = lanePositions[currentLane] - player.offsetWidth / 2 + 'px';
            scoreElement.textContent = `Pontszám: 0`;
            gameOverElement.style.display = 'none';

            // Játék újraindítása
            startGame();
        }

        // Játékelemek tisztítása
        function clearGameElements() {
            obstacles.forEach(obstacle => {
                if (obstacle.parentNode === gameContainer) {
                    gameContainer.removeChild(obstacle);
                }
            });

            bonuses.forEach(bonus => {
                if (bonus.parentNode === gameContainer) {
                    gameContainer.removeChild(bonus);
                }
            });

            roadLines.forEach(line => {
                if (line.parentNode === gameRoad) {
                    gameRoad.removeChild(line);
                }
            });
        }

        // Nehézség változtatása
        function changeDifficulty() {
            // Játék leállítása és elemek tisztítása
            cancelAnimationFrame(animationId);
            clearInterval(obstacleInterval);
            clearInterval(bonusInterval);
            clearInterval(roadLineInterval);
            clearGameElements();

            score = 0;
            scoreElement.textContent = `Pontszám: ${score}`;

            // Nehézségválasztó megjelenítése
            gameOverElement.style.display = 'none';
            difficultySelector.style.display = 'flex';
        }

        // Játék indítása
        function startGame() {
            isGameOver = false;
            updateGame();
            obstacleInterval = setInterval(createObstacle, difficultySettings[currentDifficulty].obstacleInterval);
            bonusInterval = setInterval(createBonus, difficultySettings[currentDifficulty].bonusFrequency);
            roadLineInterval = setInterval(createRoadLine, 200);
        }

        // Eseményfigyelők beállítása
        restartBtn.addEventListener('click', restartGame);
        changeDifficultyBtn.addEventListener('click', changeDifficulty);

        // Kezdeti állapot
        if (!userName) {
            userNameInputContainer.style.display = 'flex';
            difficultySelector.style.display = 'none';
        } else {
            userNameDisplay.textContent = `Játékos: ${userName}`;
            userNameInputContainer.style.display = 'none';
            difficultySelector.style.display = 'flex';
        }

    </script>
</body>
</html>